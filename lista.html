<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gerenciador de Listas de Compras</title>
  <style>
    :root {
      --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --container-bg: rgba(255, 255, 255, 0.95);
      --header-bg: linear-gradient(135deg, #4CAF50, #45a049);
      --card-bg: #f8f9fa;
      --card-border: #e9ecef;
      --text-primary: #333;
      --text-secondary: #666;
      --border-color: #ddd;
      --hover-bg: #f8f9fa;
      --completed-bg: #e8f5e8;
      --shadow: rgba(0, 0, 0, 0.1);
      --shadow-hover: rgba(76, 175, 80, 0.3);
    }
	
	.item input[type="checkbox"] {
		width: 20px;
		height: 20px;
		margin-right: 15px;
		cursor: pointer;
		transform: scale(1.2);
	}

    [data-theme="dark"] {
      --bg-gradient: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
      --container-bg: rgba(45, 55, 70, 0.95);
      --header-bg: linear-gradient(135deg, #27ae60, #229954);
      --card-bg: #34495e;
      --card-border: #4a5568;
      --text-primary: #e2e8f0;
      --text-secondary: #a0aec0;
      --border-color: #4a5568;
      --hover-bg: #3a4a5c;
      --completed-bg: #2d4a2d;
      --shadow: rgba(0, 0, 0, 0.3);
      --shadow-hover: rgba(39, 174, 96, 0.3);
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg-gradient);
      min-height: 100vh;
      padding: 20px;
      color: var(--text-primary);
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background: var(--container-bg);
      border-radius: 20px;
      box-shadow: 0 20px 40px var(--shadow);
      overflow: hidden;
    }

    .header {
      background: var(--header-bg);
      color: white;
      padding: 30px;
      text-align: center;
      position: relative;
    }

    .header h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
    }

    .theme-toggle {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      padding: 10px;
      border-radius: 50%;
      cursor: pointer;
    }

    .content { padding: 30px; }

    .list-controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }

    select, input, button {
      padding: 10px 12px;
      border: 2px solid var(--border-color);
      border-radius: 10px;
      font-size: 14px;
      background: var(--container-bg);
      color: var(--text-primary);
    }

    button {
      background: linear-gradient(135deg, #4CAF50, #45a049);
      color: white;
      border: none;
      cursor: pointer;
      font-weight: 600;
    }

    .btn-danger { background: linear-gradient(135deg, #f44336, #d32f2f); }
    .btn-secondary { background: linear-gradient(135deg, #FF9800, #F57C00); }
    .btn-info { background: linear-gradient(135deg, #2196F3, #1976D2); }

    .item-form {
      background: var(--card-bg);
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 30px;
      border: 2px solid var(--card-border);
    }

    .form-row {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr auto;
      gap: 10px;
    }

    /* Tablet: reduz a quantidade de colunas */
    @media (max-width: 768px) {
      .form-row {
        grid-template-columns: 2fr 1fr auto;
      }
    }

    /* Celular: empilha tudo em uma única coluna */
    @media (max-width: 550px) {
      .form-row {
        grid-template-columns: 1fr;
      }

      .form-row button {
        width: 100%;
      }
    }

    .current-list {
      background: var(--container-bg);
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 5px 15px var(--shadow);
    }

    .list-header {
      background: linear-gradient(135deg, #2196F3, #1976D2);
      color: white;
      padding: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .total-display {
      background: rgba(255,255,255,0.2);
      padding: 5px 10px;
      border-radius: 8px;
      font-weight: bold;
      margin-top: 5px;
      font-size: 0.9em;
    }

    .items-container { padding: 20px; }

    .item {
      display: flex;
      align-items: center;
      padding: 10px;
      border-bottom: 1px solid var(--border-color);
    }

    .item-info {
      flex: 1;
      display: flex;
      gap: 15px;
      align-items: center;
    }

    .item-price, .item-qty, .item-total {
      cursor: pointer;
    }
	
	        .recent-lists {
            flex: 1;
            background: var(--card-bg);
            border: 2px solid var(--card-border);
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .recent-lists h3 {
            margin-bottom: 15px;
            color: var(--text-primary);
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .recent-item {
            padding: 10px;
            background: var(--container-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .recent-item:hover {
            background: var(--hover-bg);
            transform: translateX(5px);
        }

        .recent-item:last-child {
            margin-bottom: 0;
        }

        .recent-item.active {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: var(--container-bg);
            margin: 15% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            color: var(--text-primary);
        }

        .modal h3 {
            margin-bottom: 20px;
            color: var(--text-primary);
        }

        .modal input {
            width: 100%;
            margin-bottom: 15px;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

    .item.completed { text-decoration: line-through; opacity: 0.6; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <button class="theme-toggle" onclick="toggleTheme()" id="themeToggle">🌙</button>
      <h1>🛒 Lista de Compras</h1>
    </div>

    <div class="content">
      <div class="list-controls">
        <select id="listSelect"><option value="">Selecionar Lista</option></select>
        <input type="text" id="newListName" placeholder="Nome da nova lista">
        <button onclick="createList()">Criar Lista</button>
        <button onclick="showDeleteConfirm()" class="btn-danger">Excluir Lista</button>
        <button onclick="exportLists()" class="btn-info">Exportar JSON</button>
        <input type="file" id="importFile" style="display:none" accept="application/json" onchange="importLists(event)">
        <button onclick="document.getElementById('importFile').click()" class="btn-secondary">Importar JSON</button>
      </div>
	<div class="recent-lists">
		<h3>Listas Recentes</h3>
		<div id="recentListsContainer">
			<div style="text-align: center; color: var(--text-secondary); font-size: 0.9em; padding: 20px;">
				Nenhuma lista criada ainda
			</div>
		</div>
	</div>

      <div id="itemFormContainer" style="display: none;">
        <div class="item-form">
          <h3>Adicionar Item</h3>
          <div class="form-row">
            <input type="text" id="itemName" placeholder="Nome do item">
            <input type="number" id="itemPrice" placeholder="Preço (R$)" step="0.01" min="0">
            <input type="number" id="itemQty" placeholder="Qtd" min="1" value="1">
            <button onclick="addItem()">Adicionar</button>
          </div>
        </div>
      </div>

      <div id="currentListContainer" style="display: none;">
        <div class="current-list">
          <div class="list-header">
            <div class="list-title" id="currentListTitle">Minha Lista</div>
            <div>
              <div class="total-display">Total (concluídos): R$ <span id="totalAmount">0,00</span></div>
              <div class="total-display">Valor Previsto: R$ <span id="valorPrevisto">0,00</span></div>
            </div>
          </div>
          <div class="items-container" id="itemsContainer"></div>
        </div>
      </div>
    </div>
  </div>

    <!-- Modal de Confirmacao de Exclusao -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeDeleteModal()">&times;</span>
            <h3>Confirmar Exclusao</h3>
            <p id="deleteMessage">Tem certeza que deseja excluir esta lista?</p>
            <div class="modal-buttons">
                <button onclick="closeDeleteModal()">Cancelar</button>
                <button onclick="confirmDelete()" class="btn-danger">Excluir</button>
            </div>
        </div>
    </div>

  <script>
    let lists = JSON.parse(localStorage.getItem('shoppingLists') || '{}');
    let currentListId = null;
    let editingItemId = null;

    function saveLists() {
      localStorage.setItem('shoppingLists', JSON.stringify(lists));
	  loadRecentLists();
    }

    function exportLists() {
      const dataStr = JSON.stringify(lists, null, 2);
      const blob = new Blob([dataStr], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "listas_de_compras.json";
      a.click();
      URL.revokeObjectURL(url);
    }

    function importLists(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const importedData = JSON.parse(e.target.result);
          if (typeof importedData === "object" && importedData !== null) {
            lists = { ...lists, ...importedData };
            saveLists();
            loadListSelector();
            selectList(currentListId);
            alert("Listas importadas com sucesso!");
          } else {
            alert("Arquivo inválido!");
          }
        } catch (err) {
          alert("Erro ao importar JSON: " + err.message);
        }
      };
      reader.readAsText(file);
    }

    function toggleTheme() {
      const currentTheme = document.documentElement.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      document.documentElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      updateThemeToggle();
    }

    function updateThemeToggle() {
      const themeToggle = document.getElementById('themeToggle');
      const currentTheme = document.documentElement.getAttribute('data-theme');
      themeToggle.textContent = currentTheme === 'dark' ? '☀️' : '🌙';
    }

	function loadRecentLists() {
		const container = document.getElementById('recentListsContainer');
		
		// Obter listas ordenadas por data de criacao (mais recentes primeiro)
		const sortedLists = Object.entries(lists)
			.sort((a, b) => new Date(b[1].created || 0) - new Date(a[1].created || 0))
			.slice(0, 3); // Apenas as 3 mais recentes

		if (sortedLists.length === 0) {
			container.innerHTML = `
				<div style="text-align: center; color: var(--text-secondary); font-size: 0.9em; padding: 20px;">
					Nenhuma lista criada ainda
				</div>
			`;
			return;
		}

		container.innerHTML = sortedLists.map(([listId, list]) => `
			<div class="recent-item ${currentListId === listId ? 'active' : ''}" 
				 onclick="selectList('${listId}')" title="Clique para abrir esta lista">
				<div style="font-weight: 500; margin-bottom: 2px;">${list.name}</div>
				<div style="font-size: 0.8em; color: var(--text-secondary);">
					${list.items.length} itens ${formatDate(list.created)}
				</div>
			</div>
		`).join('');
	}
	
	function showDeleteConfirm() {
            if (!currentListId || !lists[currentListId]) {
                alert('Nenhuma lista selecionada');
                return;
            }

            document.getElementById('deleteMessage').textContent = 
                `Tem certeza que deseja excluir a lista "${lists[currentListId].name}"? Esta acao nao pode ser desfeita.`;
            document.getElementById('deleteModal').style.display = 'block';
        }

        function closeDeleteModal() {
            document.getElementById('deleteModal').style.display = 'none';
        }

        function confirmDelete() {
            if (currentListId && lists[currentListId]) {
                delete lists[currentListId];
                saveLists();
                loadListSelector();
                selectList('');
            }
            closeDeleteModal();
        }

    function loadListSelector() {
      const select = document.getElementById('listSelect');
      select.innerHTML = '<option value="">Selecionar Lista</option>';
      Object.keys(lists).forEach(listId => {
        const option = document.createElement('option');
        option.value = listId;
        option.textContent = lists[listId].name;
        select.appendChild(option);
      });
      if (currentListId && lists[currentListId]) {
        select.value = currentListId;
      }
    }

    function createList() {
      const nameInput = document.getElementById('newListName');
      const name = nameInput.value.trim();
      if (!name) return alert('Digite um nome');
      const listId = 'list_' + Date.now();
      lists[listId] = { name, items: [], created: new Date().toISOString() };
      saveLists();
      loadListSelector();
      selectList(listId);
      nameInput.value = '';
    }

    function selectList(listId) {
      currentListId = listId;
      if (listId && lists[listId]) {
        document.getElementById('itemFormContainer').style.display = 'block';
        document.getElementById('currentListContainer').style.display = 'block';
        document.getElementById('currentListTitle').textContent = lists[listId].name;
        loadItems();
      } else {
        document.getElementById('itemFormContainer').style.display = 'none';
        document.getElementById('currentListContainer').style.display = 'none';
      }
    }

    function addItem() {
      if (!currentListId) return;
      const name = document.getElementById('itemName').value.trim();
      const price = parseFloat(document.getElementById('itemPrice').value) || 0;
      const qty = parseInt(document.getElementById('itemQty').value) || 1;
      if (!name) return alert('Digite o nome do item');
      const item = { id: 'item_' + Date.now(), name, price, quantity: qty, completed: false };
      lists[currentListId].items.push(item);
      saveLists();
      loadItems();
      document.getElementById('itemName').value = '';
      document.getElementById('itemPrice').value = '';
      document.getElementById('itemQty').value = 1;
    }

    function loadItems() {
      const container = document.getElementById('itemsContainer');
      const items = lists[currentListId].items;
      if (items.length === 0) {
        container.innerHTML = `<div style="text-align:center;color:var(--text-secondary);padding:20px;">Lista vazia</div>`;
      } else {
        container.innerHTML = items.map(item => `
          <div class="item ${item.completed ? 'completed' : ''}">
            <input type="checkbox" ${item.completed ? 'checked' : ''} onchange="toggleItem('${item.id}')">
            <div class="item-info">
              <span class="item-name">${item.name}</span>
              <span class="item-price" onclick="startEdit('${item.id}','price')">R$ ${item.price.toFixed(2).replace('.', ',')}</span>
              <span class="item-qty" onclick="startEdit('${item.id}','quantity')">Qtd: ${item.quantity}</span>
              <span class="item-total">R$ ${(item.price * item.quantity).toFixed(2).replace('.', ',')}</span>
            </div>
            <div class="item-actions">
              <button class="action-btn" onclick="confirmDeleteItem('${item.id}')">🗑️</button>
            </div>
          </div>
        `).join('');
      }
      updateTotal();
    }

    function toggleItem(itemId) {
      const item = lists[currentListId].items.find(i => i.id === itemId);
      if (item) { item.completed = !item.completed; saveLists(); loadItems(); }
    }

    function startEdit(itemId, field) {
      if (editingItemId && editingItemId !== itemId) cancelEdit();
      const item = lists[currentListId].items.find(i => i.id === itemId);
      if (!item) return;
      editingItemId = itemId;
      let selector = field === "price" ? ".item-price" : ".item-qty";
      const elements = document.querySelectorAll(selector);
      const element = Array.from(elements).find(el => el.onclick.toString().includes(itemId));
      if (element) {
        const currentValue = field === "price" ? item.price.toFixed(2) : item.quantity;
        element.innerHTML = `<input type="number" class="price-input" value="${currentValue}" step="${field === "price" ? "0.01" : "1"}" min="0" id="editInput_${itemId}_${field}" onkeypress="handleEditKeypress(event,'${itemId}','${field}')" onblur="saveEdit('${itemId}','${field}')">`;
        const input = document.getElementById(`editInput_${itemId}_${field}`);
        input.focus(); input.select();
      }
    }

    function handleEditKeypress(event,itemId,field){ if(event.key==='Enter'){ saveEdit(itemId,field);} else if(event.key==='Escape'){ cancelEdit();}}

    function saveEdit(itemId, field) {
      const input = document.getElementById(`editInput_${itemId}_${field}`);
      if (!input) return;
      const newValue = field === "price" ? parseFloat(input.value) || 0 : parseInt(input.value) || 1;
      const item = lists[currentListId].items.find(i => i.id === itemId);
      if (item) { if (field==="price") item.price=newValue; if (field==="quantity") item.quantity=newValue; saveLists(); }
      editingItemId=null; loadItems();
    }

    function cancelEdit(){ editingItemId=null; loadItems(); }

    function confirmDeleteItem(itemId) {
      const item = lists[currentListId].items.find(i => i.id === itemId);
      if (item && confirm(`Excluir "${item.name}"?`)) {
        lists[currentListId].items = lists[currentListId].items.filter(i => i.id !== itemId);
        saveLists(); loadItems();
      }
    }

    function updateTotal() {
      const items = lists[currentListId].items;
      const total = items.filter(i => i.completed).reduce((sum,i)=>sum+(i.price*i.quantity),0);
      document.getElementById('totalAmount').textContent = total.toFixed(2).replace('.', ',');
      const previsto = items.reduce((sum,i)=>sum+(i.price*i.quantity),0);
      document.getElementById('valorPrevisto').textContent = previsto.toFixed(2).replace('.', ',');
    }

	function loadRecentLists() {
  const container = document.getElementById('recentListsContainer');

  const sortedLists = Object.entries(lists)
    .sort((a, b) => new Date(b[1].created || 0) - new Date(a[1].created || 0))
    .slice(0, 3);

  if (sortedLists.length === 0) {
    container.innerHTML = `
      <div style="text-align: center; color: var(--text-secondary); font-size: 0.9em; padding: 20px;">
        Nenhuma lista criada ainda
      </div>
    `;
    return;
  }
        
  container.innerHTML = sortedLists.map(([listId, list]) => `
    <div class="recent-item ${currentListId === listId ? 'active' : ''}" 
         onclick="selectList('${listId}')" title="Clique para abrir esta lista">
      <div style="font-weight: 500; margin-bottom: 2px;">${list.name}</div>
      <div style="font-size: 0.8em; color: var(--text-secondary);">
        ${list.items.length} itens • ${formatDate(list.created)}
      </div>
    </div>
  `).join('');
}

function formatDate(dateString) {
  if (!dateString) return 'Data desconhecida';
  const date = new Date(dateString);
  const now = new Date();
  const diffTime = Math.abs(now - date);
  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

  if (diffDays === 1) return 'Hoje';
  if (diffDays === 2) return 'Ontem';
  if (diffDays <= 7) return `${diffDays - 1} dias atrás`;
  return date.toLocaleDateString('pt-BR');
}


    document.getElementById('listSelect').addEventListener('change',function(){selectList(this.value)});
    document.documentElement.setAttribute('data-theme', localStorage.getItem('theme')||'light');
    updateThemeToggle();
    loadListSelector();
loadRecentLists();
  </script>
</body>
</html>

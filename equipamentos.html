<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Cadastro de Equipamentos por Her√≥i</title>
<style>
  :root{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;line-height:1.4}
  body{max-width:1100px;margin:28px auto;padding:20px;border-radius:8px;background:#f7f7fb;color:#111}
  header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
  h1{font-size:1.2rem;margin:0}
  .row{display:flex;gap:12px;align-items:center;margin-bottom:12px;flex-wrap:wrap}
  input,select,button,textarea{padding:8px;border-radius:6px;border:1px solid #d0d0d6}
  button{cursor:pointer}
  .panel{background:#fff;padding:14px;border-radius:8px;box-shadow:0 6px 18px rgba(10,10,50,0.04);margin-bottom:14px}
  table{width:100%;border-collapse:collapse;font-size:0.95rem}
  th,td{padding:8px;border-bottom:1px solid #eee;text-align:left}
  th{background:#fafafa;font-weight:600}
  .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:8px}
  label{display:block;font-size:0.85rem;color:#444;margin-bottom:6px}
  .small{font-size:0.85rem;color:#666}
  .danger{color:#a33}
  .sum-box{background:#f2fbf6;padding:10px;border-radius:6px;border:1px solid #e0f0e6}
  footer{font-size:0.85rem;color:#666;margin-top:8px}
</style>
</head>
<body>
<header>
  <h1>Cadastro de Equipamentos por Her√≥i</h1>
  <div class="small">Armazena tudo no <strong>localStorage</strong> ‚Äî dados locais, offline e vol√°teis como sorte de loot.</div>
</header>

<div class="panel">
  <div style="display:flex;gap:8px;align-items:center;">
    <input id="heroName" placeholder="Nome do her√≥i (ex: Arthor)" />
    <button id="addHeroBtn">‚ûï Adicionar Her√≥i</button>
    <select id="heroSelect" style="min-width:220px"></select>
    <button id="deleteHeroBtn" class="danger">üóëÔ∏è Remover Her√≥i</button>
  </div>
</div>

<div class="panel" id="equipPanel">
  <h3 style="margin-top:0">Cadastrar / Editar Equipamento</h3>
  <div class="row">
    <input id="equipName" placeholder="Nome do equipamento" style="flex:1" />
    <select id="equipRarity">
      <option value="Comum">Comum</option>
      <option value="Raro">Raro</option>
      <option value="√âpico">√âpico</option>
      <option value="Lend√°rio">Lend√°rio</option>
    </select>
    <button id="addEquipBtn">‚ûï Adicionar Equipamento</button>
  </div>
  <div style="margin-top:10px">
    <strong>Preencha os valores dos status (n√∫meros). Campos vazios = 0.</strong>
    <div class="stats-grid" id="statsInputs"></div>
  </div>
</div>

<div class="panel">
  <h3 style="margin-top:0">Equipamentos do Her√≥i</h3>
  <div id="equipListWrap"></div>
</div>

<div class="panel">
  <h3 style="margin-top:0">Soma Total dos Status</h3>
  <div id="totals" class="sum-box"></div>
</div>

<footer>Feito com ceticismo, humor e esperan√ßa de um futuro com menos bugs. ‚öôÔ∏è</footer>

<script>
const STATUS = [
  "HP","DEF","Atq","Vel Atq","Evas√£o","Taxa Critica","Dano Critico",
  "Dano Undead","Dano Demon","Dano Primate","Dano Boss",
  "Redu√ß√£o no Consumo de Saciedade","Redu√ß√£o no Consumo de HUmor","Redu√ß√£o no Consumo de Vigor",
  "Velocidade de Movimento","Chance de material extra","Chance de Ouro extra"
];
const STORAGE_KEY = "heroEquipDB_v2";

let DB = loadDB();
let editingIndex = null; // modo edi√ß√£o

function loadDB(){
  try{ const raw = localStorage.getItem(STORAGE_KEY); return raw ? JSON.parse(raw) : {heroes:{}}; }
  catch(e){ return {heroes:{}}; }
}
function saveDB(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(DB)); }

const statsInputsEl = document.getElementById("statsInputs");
STATUS.forEach(s=>{
  const div=document.createElement("div");
  div.innerHTML=`<label>${s}</label><input data-stat="${s}" type="number" step="any" placeholder="0" />`;
  statsInputsEl.appendChild(div);
});

const heroSelect=document.getElementById("heroSelect");
const heroNameIn=document.getElementById("heroName");
const addHeroBtn=document.getElementById("addHeroBtn");
const deleteHeroBtn=document.getElementById("deleteHeroBtn");
const equipNameIn=document.getElementById("equipName");
const equipRarity=document.getElementById("equipRarity");
const addEquipBtn=document.getElementById("addEquipBtn");
const equipListWrap=document.getElementById("equipListWrap");
const totalsEl=document.getElementById("totals");

function refreshHeroSelect(){
  heroSelect.innerHTML="";
  const keys=Object.keys(DB.heroes);
  if(keys.length===0){
    const opt=document.createElement("option");opt.text="‚Äî Sem her√≥is ‚Äî";opt.value="";
    heroSelect.appendChild(opt); refreshEquipList(); updateTotals(); return;
  }
  keys.forEach(k=>{
    const opt=document.createElement("option");
    opt.value=k;opt.text=k;heroSelect.appendChild(opt);
  });
  if(!heroSelect.value) heroSelect.value=keys[0];
  refreshEquipList(); updateTotals();
}

function refreshEquipList(){
  const hero=heroSelect.value;
  equipListWrap.innerHTML="";
  if(!hero||!DB.heroes[hero]){
    equipListWrap.innerHTML="<div class='small'>Selecione um her√≥i.</div>";return;
  }
  const equips=DB.heroes[hero].equips||[];
  if(equips.length===0){equipListWrap.innerHTML="<div class='small'>Nenhum equipamento cadastrado.</div>";return;}
  const t=document.createElement("table");
  const th=document.createElement("thead");
  th.innerHTML="<tr><th>Nome</th><th>Raridade</th><th>Resumo</th><th>A√ß√µes</th></tr>";
  t.appendChild(th);
  const tb=document.createElement("tbody");
  equips.forEach((eq,i)=>{
    const stats=STATUS.map(s=>eq.stats[s]?`${s}: ${eq.stats[s]}`:null).filter(Boolean).join("; ");
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${escapeHtml(eq.name)}</td><td>${escapeHtml(eq.rarity)}</td>
                  <td>${escapeHtml(stats||"‚Äî")}</td>
                  <td>
                    <button data-idx="${i}" class="edit-eq">‚úèÔ∏è Editar</button>
                    <button data-idx="${i}" class="del-eq">üóëÔ∏è Remover</button>
                  </td>`;
    tb.appendChild(tr);
  });
  t.appendChild(tb); equipListWrap.appendChild(t);

  equipListWrap.querySelectorAll(".del-eq").forEach(b=>b.onclick=()=>{
    const i=+b.dataset.idx;
    if(!confirm("Remover equipamento?"))return;
    DB.heroes[hero].equips.splice(i,1);
    saveDB(); refreshEquipList(); updateTotals();
  });

  equipListWrap.querySelectorAll(".edit-eq").forEach(b=>b.onclick=()=>{
    const i=+b.dataset.idx;
    const eq=DB.heroes[hero].equips[i];
    editingIndex=i;
    equipNameIn.value=eq.name;
    equipRarity.value=eq.rarity;
    STATUS.forEach(s=>{
      const inp=statsInputsEl.querySelector(`[data-stat='${s}']`);
      inp.value=eq.stats[s]||"";
    });
    addEquipBtn.textContent="üíæ Salvar Altera√ß√µes";
    addEquipBtn.style.background="#d8f5d0";
  });
}

function updateTotals(){
  const hero=heroSelect.value;
  const totals={}; STATUS.forEach(s=>totals[s]=0);
  if(hero&&DB.heroes[hero]){
    DB.heroes[hero].equips.forEach(eq=>{
      STATUS.forEach(s=>{ totals[s]+=Number(eq.stats[s]||0); });
    });
  }
  totalsEl.innerHTML=STATUS.map(s=>`<div><strong>${s}:</strong> ${totals[s]}</div>`).join("");
}

addHeroBtn.onclick=()=>{
  const name=(heroNameIn.value||"").trim();
  if(!name)return alert("Digite o nome do her√≥i!");
  if(DB.heroes[name])return alert("Her√≥i j√° existe!");
  DB.heroes[name]={equips:[]}; saveDB(); heroNameIn.value=""; refreshHeroSelect(); heroSelect.value=name;
};

deleteHeroBtn.onclick=()=>{
  const hero=heroSelect.value;
  if(!hero)return;
  if(!confirm(`Remover ${hero} e todos os equipamentos?`))return;
  delete DB.heroes[hero]; saveDB(); refreshHeroSelect();
};

addEquipBtn.onclick=()=>{
  const hero=heroSelect.value;
  if(!hero)return alert("Selecione um her√≥i primeiro.");
  const name=(equipNameIn.value||"").trim(); if(!name)return alert("Informe o nome do equipamento.");
  const rarity=equipRarity.value;
  const stats={};
  statsInputsEl.querySelectorAll("input").forEach(inp=>{
    const val=inp.value.trim(); if(val!=="") stats[inp.dataset.stat]=Number(val);
  });

  const newEquip={name,rarity,stats};
  if(editingIndex!==null){
    DB.heroes[hero].equips[editingIndex]=newEquip;
    editingIndex=null;
    addEquipBtn.textContent="‚ûï Adicionar Equipamento";
    addEquipBtn.style.background="";
  }else{
    DB.heroes[hero].equips.push(newEquip);
  }
  saveDB();
  equipNameIn.value=""; statsInputsEl.querySelectorAll("input").forEach(i=>i.value="");
  refreshEquipList(); updateTotals();
};

heroSelect.onchange=()=>{refreshEquipList();updateTotals();};

function escapeHtml(t){return String(t).replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m]));}

refreshHeroSelect();
</script>
</body>
</html>
